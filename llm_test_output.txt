REAL LLM BOUNDARY DETECTION TEST
============================================================
⚠️  LLM caching is DISABLED - using fresh LLM calls
⚠️  This test will make actual Ollama API calls
============================================================

Available Ollama models: ['gemma2:2b', 'gemma3:1b-it-q4_K_M', 'phi4-mini-reasoning:3.8b', 'qwen3:0.6b', 'qwen3:1.7b', 'qwen3:8b', 'granite3.3:2b', 'granite3.3:8b', 'deepseek-r1:1.5b', 'deepseek-r1:8b', 'gemma3n:e2b', 'gemma3:latest', 'phi4-mini:3.8b', 'phi3:mini', 'llama3:8b-instruct-q5_K_M']

Expected boundaries: [3, 5, 7, 11, 12, 16, 18, 21, 24, 30, 32, 33, 34]
Total expected: 13
Loaded 36 pages

============================================================
PHASE 1: ENSEMBLE DETECTION (Heuristic + Embeddings)
============================================================
Ensemble detection time: 2.30s (0.064s per page)
Total boundaries found: 36
  High confidence (≥0.6): 20
  Medium confidence (0.3-0.6): 10
  Low confidence (<0.3): 6

Ensemble-only performance:
  Precision: 0.361
  Recall: 1.000
  F1 Score: 0.531

============================================================
PHASE 2: REAL LLM VERIFICATION
============================================================
Boundaries needing LLM verification: 3 (limited for testing)
Cleared LLM cache
Using LLM model: qwen3:0.6b
Cache enabled: False

Running LLM verification on uncertain boundaries...
  Checking boundary 1/3 (page 1)... ✓ Confirmed as boundary (16.4s)
  Checking boundary 2/3 (page 7)... ✓ Confirmed as boundary (7.9s)
  Checking boundary 3/3 (page 9)... ✓ Confirmed as boundary (10.2s)

Total LLM verification time: 34.45s (11.48s per boundary)

============================================================
FINAL RESULTS (Ensemble + Real LLM)
============================================================
Total processing time: 36.75s (1.021s per page)
LLM usage: 3 out of 35 possible boundaries (8.6%)

Final performance:
  Precision: 0.391
  Recall: 0.692
  F1 Score: 0.500

Detected boundaries: [0, 1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 19, 23, 28, 30, 32, 33, 35]
Expected boundaries: [3, 5, 7, 11, 12, 16, 18, 21, 24, 30, 32, 33, 34]
False positives: [0, 1, 2, 4, 6, 9, 10, 13, 14, 15, 19, 23, 28, 35]
False negatives: [18, 21, 24, 34]

============================================================
PRODUCTION READINESS ASSESSMENT
============================================================
✓ F1 Score ≥ 0.75: NO (0.500)
✓ Speed < 5s/page: YES (1.021s)
✓ LLM usage < 30%: YES (8.6%)

⚠️  System needs further optimization

============================================================
DETAILED BOUNDARY ANALYSIS
============================================================

Ensemble boundary decisions:
  ✗ Page 0: confidence=0.742
  ✗ Page 1: confidence=0.439
  ✗ Page 2: confidence=0.685
  ✓ Page 3: confidence=0.894
  ✗ Page 4: confidence=0.704
  ✓ Page 5: confidence=0.783
  ✗ Page 6: confidence=0.805
  ✓ Page 7: confidence=0.558
  ✗ Page 8: confidence=0.205
  ✗ Page 9: confidence=0.524
